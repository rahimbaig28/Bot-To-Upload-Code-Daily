<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2025-10-31T13:28:04.634162Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dynamic Data Storyboard</title>
  <style>
    :root {
      --primary-color: #4a90e2;
      --secondary-color: #50c878;
      --bg-color: #f4f6f9;
      --text-color: #333;
      --border-color: #ddd;
      --accent-color: #f39c12;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }
    header {
      text-align: center;
      padding: 1rem 0;
      background-color: var(--primary-color);
      color: white;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    .upload-section, .controls, .chart-container, .help-overlay {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 1rem;
    }
    .upload-section textarea {
      width: 100%;
      height: 100px;
      margin-bottom: 1rem;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-family: monospace;
    }
    .btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .btn:hover {
      background-color: #357abd;
    }
    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .chart-container {
      position: relative;
      overflow: hidden;
      height: 400px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
    }
    .chart {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    .color-palette {
      display: flex;
      gap: 0.5rem;
      margin: 0.5rem 0;
    }
    .color-option {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
    }
    .color-option.selected {
      border-color: var(--text-color);
    }
    .help-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      color: white;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 2rem;
      box-sizing: border-box;
    }
    .help-overlay p {
      margin-bottom: 1rem;
    }
    .close-help {
      background-color: var(--secondary-color);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 1rem;
    }
    .export-import {
      margin-top: 1rem;
    }
    .tutorial-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background-color: var(--accent-color);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
    }
    @media (max-width: 768px) {
      .btn-group {
        flex-direction: column;
      }
      .btn {
        width: 100%;
        margin-bottom: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Dynamic Data Storyboard</h1>
      <p>Upload, visualize, and explore your data with interactive charts.</p>
    </header>

    <div class="upload-section">
      <h2>Upload or Input Data</h2>
      <textarea id="json-input" placeholder='Enter JSON data (e.g., [{"date": "2020-01-01", "value": 10}, ...])'></textarea>
      <input type="file" id="file-upload" accept=".json" aria-label="Upload JSON file" />
      <div class="btn-group">
        <button id="load-data" class="btn">Load Data</button>
        <button id="clear-data" class="btn">Clear Data</button>
      </div>
    </div>

    <div class="controls">
      <h2>Visualization Controls</h2>
      <div class="btn-group">
        <button id="chart-line" class="btn" aria-pressed="false">Line Chart</button>
        <button id="chart-bar" class="btn" aria-pressed="false">Bar Chart</button>
        <button id="chart-heatmap" class="btn" aria-pressed="false">Heatmap</button>
        <button id="chart-scatter" class="btn" aria-pressed="false">Scatter Plot</button>
      </div>
      <div class="color-palette">
        <div class="color-option selected" style="background-color: #4a90e2;" data-color="#4a90e2"></div>
        <div class="color-option" style="background-color: #50c878;" data-color="#50c878"></div>
        <div class="color-option" style="background-color: #f39c12;" data-color="#f39c12"></div>
        <div class="color-option" style="background-color: #e74c3c;" data-color="#e74c3c"></div>
      </div>
      <div class="export-import">
        <button id="export-session" class="btn">Export Session</button>
        <button id="import-session" class="btn">Import Session</button>
        <input type="file" id="import-file" accept=".json" style="display:none;" aria-label="Import session file" />
      </div>
    </div>

    <div class="chart-container" tabindex="0" aria-label="Interactive chart area">
      <canvas id="chart" class="chart"></canvas>
    </div>

    <button class="tutorial-btn" id="tutorial-btn" aria-label="Open tutorial">?</button>
  </div>

  <div class="help-overlay" id="help-overlay" role="dialog" aria-labelledby="help-title">
    <h2 id="help-title">Welcome to Dynamic Data Storyboard</h2>
    <p>Upload or paste your JSON data to get started. Supported formats: array of objects with time-series or categorical fields.</p>
    <p>Choose a visualization type using the buttons above. Toggle between charts dynamically.</p>
    <p>Use zoom and pan to explore details. Customize colors with the palette.</p>
    <p>Export and import your session to save your work.</p>
    <button class="close-help" id="close-help">Got it!</button>
  </div>

  <script>
    // Global state
    let data = [];
    let chartType = 'line';
    let zoom = 1;
    let panX = 0;
    let selectedColor = '#4a90e2';
    let ctx, canvas;

    // DOM elements
    const jsonInput = document.getElementById('json-input');
    const fileUpload = document.getElementById('file-upload');
    const loadDataBtn = document.getElementById('load-data');
    const clearDataBtn = document.getElementById('clear-data');
    const chartLineBtn = document.getElementById('chart-line');
    const chartBarBtn = document.getElementById('chart-bar');
    const chartHeatmapBtn = document.getElementById('chart-heatmap');
    const chartScatterBtn = document.getElementById('chart-scatter');
    const colorOptions = document.querySelectorAll('.color-option');
    const exportSessionBtn = document.getElementById('export-session');
    const importSessionBtn = document.getElementById('import-session');
    const importFile = document.getElementById('import-file');
    const tutorialBtn = document.getElementById('tutorial-btn');
    const helpOverlay = document.getElementById('help-overlay');
    const closeHelpBtn = document.getElementById('close-help');
    const chartContainer = document.querySelector('.chart-container');
    const chartCanvas = document.getElementById('chart');

    // Initialize canvas
    canvas = chartCanvas;
    ctx = canvas.getContext('2d');
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Load from localStorage on start
    loadFromStorage();

    // Event Listeners
    loadDataBtn.addEventListener('click', loadData);
    clearDataBtn.addEventListener('click', clearData);
    fileUpload.addEventListener('change', handleFileUpload);
    importSessionBtn.addEventListener('click', () => importFile.click());
    importFile.addEventListener('change', handleImportSession);
    exportSessionBtn.addEventListener('click', exportSession);
    tutorialBtn.addEventListener('click', () => helpOverlay.style.display = 'flex');
    closeHelpBtn.addEventListener('click', () => helpOverlay.style.display = 'none');
    chartLineBtn.addEventListener('click', () => setChartType('line'));
    chartBarBtn.addEventListener('click', () => setChartType('bar'));
    chartHeatmapBtn.addEventListener('click', () => setChartType('heatmap'));
    chartScatterBtn.addEventListener('click', () => setChartType('scatter'));
    colorOptions.forEach(option => {
      option.addEventListener('click', () => {
        colorOptions.forEach(o => o.classList.remove('selected'));
        option.classList.add('selected');
        selectedColor = option.dataset.color;
        drawChart();
      });
    });

    // Keyboard navigation for chart controls
    [chartLineBtn, chartBarBtn, chartHeatmapBtn, chartScatterBtn].forEach(btn => {
      btn.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          btn.click();
        }
      });
    });

    // Zoom and pan with mouse/touch
    let isDragging = false;
    let lastX = 0;
    chartContainer.addEventListener('mousedown', e => {
      isDragging = true;
      lastX = e.clientX;
      chartContainer.style.cursor = 'grabbing';
    });
    chartContainer.addEventListener('mousemove', e => {
      if (isDragging) {
        const dx = e.clientX - lastX;
        panX += dx * (1 / zoom);
        lastX = e.clientX;
        drawChart();
      }
    });
    chartContainer.addEventListener('mouseup', () => {
      isDragging = false;
      chartContainer.style.cursor = 'grab';
    });
    chartContainer.addEventListener('mouseleave', () => {
      isDragging = false;
      chartContainer.style.cursor = 'grab';
    });
    chartContainer.addEventListener('wheel', e => {
      e.preventDefault();
      const delta = e.deltaY > 0 ? 0.9 : 1.1;
      zoom *= delta;
      zoom = Math.max(0.5, Math.min(zoom, 5));
      drawChart();
    });

    // Touch support for mobile
    let touchStartX = 0;
    chartContainer.addEventListener('touchstart', e => {
      isDragging = true;
      touchStartX = e.touches.clientX;
      chartContainer.style.cursor = 'grabbing';
    });
    chartContainer.addEventListener('touchmove', e => {
      if (isDragging) {
        const dx = e.touches.clientX - touchStartX;
        panX += dx * (1 / zoom);
        touchStartX = e.touches.clientX;
        drawChart();
      }
    });
    chartContainer.addEventListener('touchend', () => {
      isDragging = false;
      chartContainer.style.cursor = 'grab';
    });

    // Functions
    function resizeCanvas() {
      const rect = chartContainer.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = rect.height;
      drawChart();
    }

    function loadData() {
      try {
        const input = jsonInput.value.trim();
        if (!input) throw new Error('No data provided');
        const parsed = JSON.parse(input);
        if (!Array.isArray(parsed)) throw new Error('Data must be an array');
        data = parsed;
        detectAndSuggestCharts();
        drawChart();
        saveToStorage();
      } catch (err) {
        alert('Invalid JSON or data format: ' + err.message);
      }
    }

    function handleFileUpload(e) {
      const file = e.target.files;
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(event) {
        jsonInput.value = event.target.result;
        loadData();
      };
      reader.readAsText(file);
    }

    function clearData() {
      data = [];
      jsonInput.value = '';
      drawChart();
      saveToStorage();
    }

    function detectAndSuggestCharts() {
      if (data.length === 0) return;
      const keys = Object.keys(data);
      const hasTime = keys.some(k => /date|time/i.test(k));
      const hasNumeric = keys.some(k => typeof data[k] === 'number');
      // Suggest charts based on data structure
      if (hasTime && hasNumeric) {
        chartLineBtn.disabled = false;
        chartBarBtn.disabled = false;
        chartScatterBtn.disabled = false;
      } else if (hasNumeric) {
        chartBarBtn.disabled = false;
        chartScatterBtn.disabled = false;
      }
      // Heatmap for matrix-like data
      if (data.every(row => Array.isArray(row))) {
        chartHeatmapBtn.disabled = false;
      }
    }

    function setChartType(type) {
      chartType = type;
      [chartLineBtn, chartBarBtn, chartHeatmapBtn, chartScatterBtn].forEach(btn => {
        btn.setAttribute('aria-pressed', btn.id === `chart-${type}` ? 'true' : 'false');
      });
      drawChart();
      saveToStorage();
    }

    function drawChart() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (data.length === 0) return;

      const w = canvas.width;
      const h = canvas.height;
      const padding = 40;
      const chartW = w - 2 * padding;
      const chartH = h - 2 * padding;

      // Determine axes
      const keys = Object.keys(data);
      const xKey = keys;
      const yKey = keys.length > 1 ? keys[1] : keys;

      // Scale and offset
      const xMin = Math.min(...data.map(d => d[xKey]));
      const xMax = Math.max(...data.map(d => d[xKey]));
      const yMin = Math.min(...data.map(d => d[yKey]));
      const yMax = Math.max(...data.map(d => d[yKey]));
      const xRange = xMax - xMin;
      const yRange = yMax - yMin;

      const scaleX = chartW / xRange;
      const scaleY = chartH / yRange;

      // Draw axes
      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, h - padding);
      ctx.lineTo(w - padding, h - padding);
      ctx.strokeStyle = '#aaa';
      ctx.stroke();

      // Labels
      ctx.fillStyle = '#333';
      ctx.font = '12px sans-serif';
      ctx.fillText(xKey, w - padding, h - 10);
      ctx.save();
      ctx.translate(10, h / 2);
      ctx.rotate(-Math.PI / 2);
      ctx.fillText(yKey, 0, 0);
      ctx.restore();

      // Draw data
      ctx.strokeStyle = selectedColor;
      ctx.fillStyle = selectedColor;
      ctx.lineWidth = 2;

      if (chartType === 'line') {
        ctx.beginPath();
        data.forEach((d, i) => {
          const x = padding + (d[xKey] - xMin) * scaleX / zoom - panX;
          const y = h - padding - (d[yKey] - yMin) * scaleY / zoom;
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });
        ctx.stroke();
      } else if (chartType === 'bar') {
        const barWidth = Math.max(10, chartW / data.length / zoom);
        data.forEach((d, i) => {
          const x = padding + (d[xKey] - xMin) * scaleX / zoom - panX;
          const y = h - padding - (d[yKey] - yMin) * scaleY / zoom;
          const height = (d[yKey] - yMin) * scaleY / zoom;
          ctx.fillRect(x, y, barWidth, height);
        });
      } else if (chartType === 'scatter') {
        data.forEach(d => {
          const x = padding + (d[xKey] - xMin) * scaleX / zoom - panX;
          const y = h - padding - (d[yKey] - yMin) * scaleY / zoom;
          ctx.beginPath();
          ctx.arc(x, y, 4, 0, 2 * Math.PI);
          ctx.fill();
        });
      } else if (chartType === 'heatmap') {
        // Simplified heatmap for matrix data
        const cellSize = Math.min(chartW, chartH) / Math.max(data.length, data.length);
        data.forEach((row, i) => {
          row.forEach((val, j) => {
            const x = padding + j * cellSize / zoom - panX;
            const y = padding + i * cellSize / zoom;
            const intensity = (val - yMin) / yRange;
            ctx.fillStyle = `rgba(74, 144, 226, ${intensity})`;
            ctx.fillRect(x, y, cellSize, cellSize);
          });
        });
      }
    }

    function exportSession() {
      const session = {
        data,
        chartType,
        zoom,
        panX,
        selectedColor
      };
      const blob = new Blob([JSON.stringify(session, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'storyboard-session.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function handleImportSession(e) {
      const file = e.target.files;
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          const session = JSON.parse(event.target.result);
          data = session.data || [];
          chartType = session.chartType || 'line';
          zoom = session.zoom || 1;
          panX = session.panX || 0;
          selectedColor = session.selectedColor || '#4a90e2';
          // Update UI
          [chartLineBtn, chartBarBtn, chartHeatmapBtn, chartScatterBtn].forEach(btn => {
            btn.setAttribute('aria-pressed', btn.id === `chart-${chartType}` ? 'true' : 'false');
          });
          colorOptions.forEach(option => {
            option.classList.remove('selected');
            if (option.dataset.color === selectedColor) option.classList.add('selected');
          });
          jsonInput.value = JSON.stringify(data, null, 2);
          drawChart();
        } catch (err) {
          alert('Invalid session file: ' + err.message);
        }
      };
      reader.readAsText(file);
    }

    function saveToStorage() {
      const session = {
        data,
        chartType,
        zoom,
        panX,
        selectedColor
      };
      localStorage.setItem('storyboard-session', JSON.stringify(session));
    }

    function loadFromStorage() {
      const saved = localStorage.getItem('storyboard-session');
      if (saved) {
        try {
          const session = JSON.parse(saved);
          data = session.data || [];
          chartType = session.chartType || 'line';
          zoom = session.zoom || 1;
          panX = session.panX || 0;
          selectedColor = session.selectedColor || '#4a90e2';
          jsonInput.value = JSON.stringify(data, null, 2);
          // Update UI
          [chartLineBtn, chartBarBtn, chartHeatmapBtn, chartScatterBtn].forEach(btn => {
            btn.setAttribute('aria-pressed', btn.id === `chart-${chartType}` ? 'true' : 'false');
          });
          colorOptions.forEach(option => {
            option.classList.remove('selected');
            if (option.dataset.color === selectedColor) option.classList.add('selected');
          });
          drawChart();
        } catch (err) {
          console.warn('Failed to load session from storage:', err);
        }
      }
    }

    // Initial draw
    drawChart();
  </script>
</body>
</html>