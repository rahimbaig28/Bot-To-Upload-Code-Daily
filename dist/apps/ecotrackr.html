<!DOCTYPE html>
<html lang="en">
<head>
<!-- Auto-generated via Perplexity on 2025-11-04T13:31:59.761570Z -->

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EcoTrackr</title>
  <style>
    :root {
      --bg: #f8f9fa;
      --text: #212529;
      --accent: #28a745;
      --border: #dee2e6;
      --highlight: #d4edda;
      --contrast: #000;
      --contrast-bg: #fff;
      --contrast-text: #fff;
      --contrast-accent: #155724;
      --shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    [data-theme="high-contrast"] {
      --bg: #000;
      --text: #fff;
      --accent: #0f0;
      --border: #fff;
      --highlight: #000;
      --contrast: #fff;
      --contrast-bg: #000;
      --contrast-text: #000;
      --contrast-accent: #0f0;
      --shadow: 0 2px 4px rgba(255,255,255,0.1);
    }
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 1rem;
    }
    h1, h2, h3 {
      color: var(--accent);
    }
    button, input, select {
      font: inherit;
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      background: var(--bg);
      color: var(--text);
    }
    button {
      cursor: pointer;
    }
    button:focus, input:focus, select:focus {
      outline: 2px solid var(--accent);
    }
    .btn-accent {
      background: var(--accent);
      color: var(--contrast-text);
    }
    .btn-accent:focus {
      outline: 2px solid var(--accent);
    }
    .btn-undo, .btn-redo {
      background: #6c757d;
      color: var(--contrast-text);
    }
    .btn-undo:disabled, .btn-redo:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .form-row > * {
      flex: 1;
      min-width: 120px;
    }
    .entry {
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      margin-bottom: 0.5rem;
      background: var(--bg);
      box-shadow: var(--shadow);
      transition: background 0.3s;
    }
    .entry.highlight {
      background: var(--highlight);
    }
    .entry-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    .chart-container {
      margin: 1rem 0;
      height: 300px;
      overflow-x: auto;
      white-space: nowrap;
    }
    .bar {
      display: inline-block;
      width: 30px;
      background: var(--accent);
      margin-right: 2px;
      text-align: center;
      color: var(--contrast-text);
      font-size: 0.7rem;
      position: relative;
      vertical-align: bottom;
    }
    .bar-label {
      position: absolute;
      bottom: -1.5rem;
      left: 0;
      right: 0;
      white-space: nowrap;
    }
    .tips {
      margin: 1rem 0;
      padding: 1rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      background: var(--bg);
    }
    .tips h3 {
      margin-top: 0;
    }
    .nav {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .view-toggle {
      display: flex;
      gap: 0.5rem;
    }
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap;
      border: 0;
    }
    .high-contrast-toggle {
      margin-left: auto;
    }
    @media (max-width: 600px) {
      .form-row > * {
        flex: 1 1 100%;
      }
      .bar {
        width: 20px;
        font-size: 0.6rem;
      }
      .bar-label {
        bottom: -2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>EcoTrackr</h1>
      <p>Track your daily sustainability goals and carbon footprint.</p>
      <div class="nav">
        <div class="view-toggle">
          <button id="view-list" class="btn-accent" aria-pressed="true">List View</button>
          <button id="view-chart">Chart View</button>
        </div>
        <button id="high-contrast" class="high-contrast-toggle">High Contrast</button>
      </div>
    </header>

    <main>
      <section id="input-section">
        <h2>Add Activity</h2>
        <form id="activity-form">
          <div class="form-row">
            <div class="form-group">
              <label for="activity-date">Date</label>
              <input type="date" id="activity-date" required />
            </div>
            <div class="form-group">
              <label for="activity-type">Type</label>
              <select id="activity-type" required>
                <option value="">Select...</option>
                <option value="commute">Commute</option>
                <option value="diet">Diet</option>
                <option value="energy">Energy Use</option>
                <option value="water">Water Use</option>
              </select>
            </div>
            <div class="form-group">
              <label for="activity-value">Value (e.g., miles, kWh, liters)</label>
              <input type="number" id="activity-value" min="0" step="any" required />
            </div>
            <div class="form-group">
              <label for="activity-unit">Unit</label>
              <select id="activity-unit" required>
                <option value="">Select...</option>
                <option value="miles">miles</option>
                <option value="kWh">kWh</option>
                <option value="liters">liters</option>
              </select>
            </div>
          </div>
          <button type="submit" class="btn-accent">Add Entry</button>
        </form>
      </section>

      <section id="entries-section">
        <h2>Recent Entries</h2>
        <div id="entries-list"></div>
        <div class="entry-actions">
          <button id="undo" class="btn-undo" disabled>Undo</button>
          <button id="redo" class="btn-redo" disabled>Redo</button>
        </div>
      </section>

      <section id="chart-section" hidden>
        <h2>Weekly Carbon Footprint</h2>
        <div class="chart-container" id="chart"></div>
      </section>

      <section class="tips">
        <h3>Daily Tip</h3>
        <p id="tip-text">Loading tip...</p>
      </section>
    </main>

    <footer>
      <p>
        <button id="export">Export Data</button>
        <button id="import">Import Data</button>
        <input type="file" id="import-file" accept=".json" hidden />
      </p>
      <p>Use keyboard navigation: Tab to move, Enter to activate, Esc to cancel.</p>
    </footer>
  </div>

  <script>
    // Constants
    const CO2_FACTORS = {
      commute: { miles: 0.404 }, // kg CO2 per mile (car)
      diet: { miles: 0.003 }, // kg CO2 per kcal (approx)
      energy: { kWh: 0.5 }, // kg CO2 per kWh (avg grid)
      water: { liters: 0.0002 } // kg CO2 per liter (pumping/treatment)
    };

    // State
    let entries = [];
    let undoStack = [];
    let redoStack = [];
    const MAX_UNDO = 20;
    let currentView = 'list';
    let highContrast = false;

    // DOM elements
    const form = document.getElementById('activity-form');
    const entriesList = document.getElementById('entries-list');
    const chartContainer = document.getElementById('chart');
    const undoBtn = document.getElementById('undo');
    const redoBtn = document.getElementById('redo');
    const viewListBtn = document.getElementById('view-list');
    const viewChartBtn = document.getElementById('view-chart');
    const highContrastBtn = document.getElementById('high-contrast');
    const exportBtn = document.getElementById('export');
    const importBtn = document.getElementById('import');
    const importFile = document.getElementById('import-file');
    const tipText = document.getElementById('tip-text');

    // Tips by language
    const tips = {
      en: [
        "Walk or bike for short trips to reduce emissions.",
        "Switch to LED bulbs to save energy.",
        "Eat more plant-based meals to lower your carbon footprint.",
        "Turn off lights when not in use.",
        "Use a reusable water bottle."
      ],
      es: [
        "Camina o anda en bicicleta para viajes cortos para reducir emisiones.",
        "Cambia a bombillas LED para ahorrar energía.",
        "Come más comidas basadas en plantas para reducir tu huella de carbono.",
        "Apaga las luces cuando no las uses.",
        "Usa una botella de agua reutilizable."
      ],
      de: [
        "Gehen oder fahren Sie mit dem Fahrrad für kurze Strecken, um Emissionen zu reduzieren.",
        "Wechseln Sie zu LED-Lampen, um Energie zu sparen.",
        "Essen Sie mehr pflanzliche Mahlzeiten, um Ihren CO2-Fußabdruck zu senken.",
        "Schalten Sie das Licht aus, wenn Sie es nicht benutzen.",
        "Verwenden Sie eine wiederverwendbare Wasserflasche."
      ],
      fr: [
        "Marchez ou faites du vélo pour les courts trajets afin de réduire les émissions.",
        "Passez à des ampoules LED pour économiser de l'énergie.",
        "Mangez plus de repas à base de plantes pour réduire votre empreinte carbone.",
        "Éteignez les lumières lorsque vous ne les utilisez pas.",
        "Utilisez une bouteille d'eau réutilisable."
      ],
      bg: [
        "Ходете или карайте с велосипед за кратки разстояния, за да намалите емисиите.",
        "Сменете на LED крушки, за да спестите енергия.",
        "Яжте повече растителни ястия, за да намалите въглеродния си отпечатък.",
        "Изключвайте светлините, когато не ги използвате.",
        "Използвайте многократно използваема бутилка за вода."
      ],
      el: [
        "Περπατήστε ή πηγαίνετε με ποδήλατο για μικρές αποστάσεις για να μειώσετε τις εκπομπές.",
        "Αλλάξτε σε λαμπτήρες LED για να εξοικονομήσετε ενέργεια.",
        "Φάτε περισσότερα φυτικά γεύματα για να μειώσετε το αποτύπωμα άνθρακα.",
        "Κλείστε τα φώτα όταν δεν τα χρησιμοποιείτε.",
        "Χρησιμοποιήστε επαναχρησιμοποιήσιμο μπουκάλι νερού."
      ]
    };

    // Initialize
    function init() {
      loadState();
      updateEntries();
      updateChart();
      updateUndoRedo();
      updateView();
      updateTip();
      updateUrl();
      setupEventListeners();
    }

    // Load state from localStorage
    function loadState() {
      const saved = localStorage.getItem('ecotrackr');
      if (saved) {
        const data = JSON.parse(saved);
        entries = data.entries || [];
        undoStack = data.undoStack || [];
        redoStack = data.redoStack || [];
        highContrast = data.highContrast || false;
        if (highContrast) {
          document.documentElement.setAttribute('data-theme', 'high-contrast');
          highContrastBtn.textContent = 'Normal Contrast';
        }
      }
      // Parse URL hash
      const hash = window.location.hash.substring(1);
      const params = new URLSearchParams(hash);
      currentView = params.get('view') || 'list';
      if (params.has('week')) {
        // Not implemented: week filter
      }
    }

    // Save state to localStorage
    function saveState() {
      const data = { entries, undoStack, redoStack, highContrast };
      localStorage.setItem('ecotrackr', JSON.stringify(data));
    }

    // Update entries list
    function updateEntries() {
      entriesList.innerHTML = '';
      entries.forEach((entry, index) => {
        const el = document.createElement('div');
        el.className = 'entry';
        el.innerHTML = `
          <p><strong>${entry.date}</strong>: ${entry.type} (${entry.value} ${entry.unit}) = ${entry.co2.toFixed(2)} kg CO₂e</p>
          <div class="entry-actions">
            <button class="btn-edit" data-index="${index}" aria-label="Edit entry ${index + 1}">Edit</button>
            <button class="btn-delete" data-index="${index}" aria-label="Delete entry ${index + 1}">Delete</button>
          </div>
        `;
        entriesList.appendChild(el);
      });
      // Add event listeners for edit/delete
      document.querySelectorAll('.btn-edit').forEach(btn => {
        btn.addEventListener('click', editEntry);
      });
      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', deleteEntry);
      });
    }

    // Update chart
    function updateChart() {
      chartContainer.innerHTML = '';
      const weekly = {};
      entries.forEach(entry => {
        const date = new Date(entry.date);
        const week = Math.floor(date.getTime() / (1000 * 60 * 60 * 24 * 7));
        weekly[week] = (weekly[week] || 0) + entry.co2;
      });
      const weeks = Object.keys(weekly).sort();
      weeks.forEach(week => {
        const bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.height = `${Math.min(weekly[week] * 10, 280)}px`;
        bar.textContent = weekly[week].toFixed(1);
        bar.setAttribute('role', 'img');
        bar.setAttribute('aria-label', `Week ${week}: ${weekly[week].toFixed(1)} kg CO₂e`);
        const label = document.createElement('div');
        label.className = 'bar-label';
        label.textContent = `W${week}`;
        bar.appendChild(label);
        chartContainer.appendChild(bar);
      });
    }

    // Calculate CO2 for an entry
    function calculateCO2(type, value, unit) {
      const factor = CO2_FACTORS[type] && CO2_FACTORS[type][unit];
      return factor ? value * factor : 0;
    }

    // Add entry
    function addEntry(date, type, value, unit) {
      const co2 = calculateCO2(type, value, unit);
      const entry = { date, type, value, unit, co2 };
      pushUndo({ action: 'add', entry });
      entries.push(entry);
      saveState();
      updateEntries();
      updateChart();
      updateUndoRedo();
      updateUrl();
    }

    // Edit entry
    function editEntry(e) {
      const index = parseInt(e.target.dataset.index);
      const entry = entries[index];
      document.getElementById('activity-date').value = entry.date;
      document.getElementById('activity-type').value = entry.type;
      document.getElementById('activity-value').value = entry.value;
      document.getElementById('activity-unit').value = entry.unit;
      pushUndo({ action: 'edit', index, oldEntry: { ...entry } });
      entries.splice(index, 1);
      saveState();
      updateEntries();
      updateChart();
      updateUndoRedo();
      updateUrl();
    }

    // Delete entry
    function deleteEntry(e) {
      const index = parseInt(e.target.dataset.index);
      const entry = entries[index];
      pushUndo({ action: 'delete', index, entry });
      entries.splice(index, 1);
      saveState();
      updateEntries();
      updateChart();
      updateUndoRedo();
      updateUrl();
    }

    // Push to undo stack
    function pushUndo(action) {
      undoStack.push(action);
      if (undoStack.length > MAX_UNDO) {
        undoStack.shift();
      }
      redoStack = [];
      updateUndoRedo();
    }

    // Undo last action
    function undo() {
      if (undoStack.length === 0) return;
      const action = undoStack.pop();
      redoStack.push(action);
      switch (action.action) {
        case 'add':
          entries.pop();
          break;
        case 'edit':
          entries.splice(action.index, 0, action.oldEntry);
          break;
        case 'delete':
          entries.splice(action.index, 0, action.entry);
          break;
      }
      saveState();
      updateEntries();
      updateChart();
      updateUndoRedo();
      updateUrl();
    }

    // Redo last undone action
    function redo() {
      if (redoStack.length === 0) return;
      const action = redoStack.pop();
      undoStack.push(action);
      switch (action.action) {
        case 'add':
          entries.push(action.entry);
          break;
        case 'edit':
          entries.splice(action.index, 1);
          break;
        case 'delete':
          entries.splice(action.index, 1);
          break;
      }
      saveState();
      updateEntries();
      updateChart();
      updateUndoRedo();
      updateUrl();
    }

    // Update undo/redo buttons
    function updateUndoRedo() {
      undoBtn.disabled = undoStack.length === 0;
      redoBtn.disabled = redoStack.length === 0;
    }

    // Update view
    function updateView() {
      if (currentView === 'list') {
        entriesSection.hidden = false;
        chartSection.hidden = true;
        viewListBtn.setAttribute('aria-pressed', 'true');
        viewChartBtn.setAttribute('aria-pressed', 'false');
      } else {
        entriesSection.hidden = true;
        chartSection.hidden = false;
        viewListBtn.setAttribute('aria-pressed', 'false');
        viewChartBtn.setAttribute('aria-pressed', 'true');
      }
    }

    // Update URL hash
    function updateUrl() {
      const params = new URLSearchParams();
      params.set('view', currentView);
      // Not implemented: week filter
      window.location.hash = params.toString();
    }

    // Update tip
    function updateTip() {
      const lang = navigator.language.split('-');
      const tipList = tips[lang] || tips.en;
      const randomTip = tipList[Math.floor(Math.random() * tipList.length)];
      tipText.textContent = randomTip;
    }

    // Export data
    function exportData() {
      const data = { entries, undoStack, redoStack, highContrast };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'ecotrackr-data.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Import data
    function importData(e) {
      const file = e.target.files;
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          const data = JSON.parse(event.target.result);
          entries = data.entries || [];
          undoStack = data.undoStack || [];
          redoStack = data.redoStack || [];
          highContrast = data.highContrast || false;
          if (highContrast) {
            document.documentElement.setAttribute('data-theme', 'high-contrast');
            highContrastBtn.textContent = 'Normal Contrast';
          } else {
            document.documentElement.removeAttribute('data-theme');
            highContrastBtn.textContent = 'High Contrast';
          }
          saveState();
          updateEntries();
          updateChart();
          updateUndoRedo();
          updateView();
          updateUrl();
          updateTip();
        } catch (err) {
          alert('Invalid file format');
        }
      };
      reader.readAsText(file);
    }

    // Setup event listeners
    function setupEventListeners() {
      form.addEventListener('submit', e => {
        e.preventDefault();
        const date = document.getElementById('activity-date').value;
        const type = document.getElementById('activity-type').value;
        const value = parseFloat(document.getElementById('activity-value').value);
        const unit = document.getElementById('activity-unit').value;
        if (!date || !type || isNaN(value) || !unit) return;
        addEntry(date, type, value, unit);
        form.reset();
      });

      undoBtn.addEventListener('click', undo);
      redoBtn.addEventListener('click', redo);

      viewListBtn.addEventListener('click', () => {
        currentView = 'list';
        updateView();
        updateUrl();
      });

      viewChartBtn.addEventListener('click', () => {
        currentView = 'chart';
        updateView();
        updateUrl();
      });

      highContrastBtn.addEventListener('click', () => {
        highContrast = !highContrast;
        if (highContrast) {
          document.documentElement.setAttribute('data-theme', 'high-contrast');
          highContrastBtn.textContent = 'Normal Contrast';
        } else {
          document.documentElement.removeAttribute('data-theme');
          highContrastBtn.textContent = 'High Contrast';
        }
        saveState();
      });

      exportBtn.addEventListener('click', exportData);
      importBtn.addEventListener('click', () => importFile.click());
      importFile.addEventListener('change', importData);

      // Listen for hash changes
      window.addEventListener('hashchange', () => {
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        currentView = params.get('view') || 'list';
        updateView();
      });
    }

    // Start app
    init();
  </script>
</body>
</html>